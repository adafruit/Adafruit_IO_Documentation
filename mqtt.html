


<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Adafruit IO API Reference</title>

    <link href="images/favicon/favicon.ico" rel="icon" type="image/ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="images/favicon/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon/favicon-16x16.png">
    <link rel="manifest" href="images/favicon/site.webmanifest">
    <link rel="mask-icon" href="images/favicon/safari-pinned-tab.svg" color="#00A7E9">
    <meta name="msapplication-TileColor" content="#00A7E9">
    <meta name="theme-color" content="#000000">

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
  background-color: #272822;
}
.highlight .nn {
  color: #ffffff;
  background-color: #272822;
}
.highlight .nl {
  color: #ffffff;
  background-color: #272822;
}
.highlight .ni {
  color: #ffffff;
  background-color: #272822;
}
.highlight .bp {
  color: #ffffff;
  background-color: #272822;
}
.highlight .vg {
  color: #ffffff;
  background-color: #272822;
}
.highlight .vi {
  color: #ffffff;
  background-color: #272822;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
  background-color: #272822;
}
.highlight .w {
  color: #ffffff;
  background-color: #272822;
}
.highlight {
  color: #ffffff;
  background-color: #272822;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
  background-color: #272822;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="mqtt" data-languages="[&quot;shell&quot;,&quot;cpp&quot;,&quot;python&quot;,&quot;python&quot;,&quot;ruby&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="" />

        <div class="lang-selector">
              <a href="#" data-language-name="shell">cURL</a>
              <a href="#" data-language-name="cpp">Arduino</a>
              <a href="#" data-language-name="python">Python</a>
              <a href="#" data-language-name="python">Circuitpython</a>
              <a href="#" data-language-name="ruby">Ruby</a>
        </div>

        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>

      <ul id="toc" class="toc-list-h1">
            <li>
<a href="./" class="toc-h1 toc-link prepend">                Adafruit IO HTTP API
                <i class="fa fa-external-link"></i>
</a>            </li>

          <li class="on-screen">
            <a href="#adafruit-io-mqtt-api" class="toc-h1 toc-link" data-title="Adafruit IO MQTT API">
              Adafruit IO MQTT API
                <span class="menu-arrow">
                  <svg width="18" height="18" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1171 960q0 13-10 23l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23z"/></svg>
                  <!-- <span>&gt;</span> -->
                </span>
            </a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#client-libraries" class="toc-h2 toc-link" data-title="Client Libraries">Client Libraries</a>
                  </li>
                  <li>
                    <a href="#mqtt-connection-details" class="toc-h2 toc-link" data-title="MQTT Connection Details">MQTT Connection Details</a>
                  </li>
              </ul>
          </li>
          <li class="on-screen">
            <a href="#mqtt-qos" class="toc-h1 toc-link" data-title="MQTT QoS">
              MQTT QoS
            </a>
          </li>
          <li class="on-screen">
            <a href="#mqtt-api-rate-limiting" class="toc-h1 toc-link" data-title="MQTT API Rate Limiting">
              MQTT API Rate Limiting
                <span class="menu-arrow">
                  <svg width="18" height="18" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1171 960q0 13-10 23l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23z"/></svg>
                  <!-- <span>&gt;</span> -->
                </span>
            </a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#rate-limit-bans" class="toc-h2 toc-link" data-title="Rate Limit Bans">Rate Limit Bans</a>
                  </li>
                  <li>
                    <a href="#preventing-mqtt-bans" class="toc-h2 toc-link" data-title="Preventing MQTT Bans">Preventing MQTT Bans</a>
                  </li>
              </ul>
          </li>
          <li class="on-screen">
            <a href="#mqtt-data-format" class="toc-h1 toc-link" data-title="MQTT Data Format">
              MQTT Data Format
                <span class="menu-arrow">
                  <svg width="18" height="18" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1171 960q0 13-10 23l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23z"/></svg>
                  <!-- <span>&gt;</span> -->
                </span>
            </a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#sending-data-with-location" class="toc-h2 toc-link" data-title="Sending data with location">Sending data with location</a>
                  </li>
                  <li>
                    <a href="#sending-json" class="toc-h2 toc-link" data-title="Sending JSON">Sending JSON</a>
                  </li>
                  <li>
                    <a href="#sending-csv" class="toc-h2 toc-link" data-title="Sending CSV">Sending CSV</a>
                  </li>
                  <li>
                    <a href="#sending-json-data-through-adafruit-io" class="toc-h2 toc-link" data-title="Sending JSON Data through Adafruit IO">Sending JSON Data through Adafruit IO</a>
                  </li>
              </ul>
          </li>
          <li class="on-screen">
            <a href="#retained-values" class="toc-h1 toc-link" data-title="Retained values">
              Retained values
                <span class="menu-arrow">
                  <svg width="18" height="18" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1171 960q0 13-10 23l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23z"/></svg>
                  <!-- <span>&gt;</span> -->
                </span>
            </a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#mqtt-retain" class="toc-h2 toc-link" data-title="MQTT Retain">MQTT Retain</a>
                  </li>
                  <li>
                    <a href="#adafruit-io-39-s-limitations" class="toc-h2 toc-link" data-title="Adafruit IO's Limitations">Adafruit IO's Limitations</a>
                  </li>
                  <li>
                    <a href="#using-the-get-topic" class="toc-h2 toc-link" data-title="Using the */get topic">Using the */get topic</a>
                  </li>
              </ul>
          </li>
          <li class="on-screen">
            <a href="#mqtt-topics" class="toc-h1 toc-link" data-title="MQTT Topics">
              MQTT Topics
                <span class="menu-arrow">
                  <svg width="18" height="18" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1171 960q0 13-10 23l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23z"/></svg>
                  <!-- <span>&gt;</span> -->
                </span>
            </a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#feed-topic-format" class="toc-h2 toc-link" data-title="Feed Topic Format">Feed Topic Format</a>
                  </li>
                  <li>
                    <a href="#group-topic-format" class="toc-h2 toc-link" data-title="Group Topic Format">Group Topic Format</a>
                  </li>
                  <li>
                    <a href="#small-topic-format" class="toc-h2 toc-link" data-title="Small Topic Format">Small Topic Format</a>
                  </li>
                  <li>
                    <a href="#using-a-wildcard" class="toc-h2 toc-link" data-title="Using a Wildcard">Using a Wildcard</a>
                  </li>
              </ul>
          </li>
          <li class="on-screen">
            <a href="#group-topics" class="toc-h1 toc-link" data-title="Group Topics">
              Group Topics
                <span class="menu-arrow">
                  <svg width="18" height="18" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1171 960q0 13-10 23l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23z"/></svg>
                  <!-- <span>&gt;</span> -->
                </span>
            </a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#publish-to-feeds-in-a-group" class="toc-h2 toc-link" data-title="Publish to Feeds in a Group">Publish to Feeds in a Group</a>
                  </li>
                  <li>
                    <a href="#group-guidelines" class="toc-h2 toc-link" data-title="Group Guidelines">Group Guidelines</a>
                  </li>
              </ul>
          </li>
          <li class="on-screen">
            <a href="#time-topics" class="toc-h1 toc-link" data-title="Time Topics">
              Time Topics
                <span class="menu-arrow">
                  <svg width="18" height="18" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1171 960q0 13-10 23l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23z"/></svg>
                  <!-- <span>&gt;</span> -->
                </span>
            </a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#time-seconds" class="toc-h2 toc-link" data-title="time/seconds">time/seconds</a>
                  </li>
                  <li>
                    <a href="#time-millis" class="toc-h2 toc-link" data-title="time/millis">time/millis</a>
                  </li>
                  <li>
                    <a href="#time-iso-8601" class="toc-h2 toc-link" data-title="time/ISO-8601">time/ISO-8601</a>
                  </li>
                  <li>
                    <a href="#time-hours" class="toc-h2 toc-link" data-title="time/hours">time/hours</a>
                  </li>
              </ul>
          </li>
          <li class="on-screen">
            <a href="#randomizer-topics" class="toc-h1 toc-link" data-title="Randomizer Topics">
              Randomizer Topics
                <span class="menu-arrow">
                  <svg width="18" height="18" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1171 960q0 13-10 23l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23z"/></svg>
                  <!-- <span>&gt;</span> -->
                </span>
            </a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#subscribe-to-the-generated-topic" class="toc-h2 toc-link" data-title="Subscribe to the Generated Topic">Subscribe to the Generated Topic</a>
                  </li>
              </ul>
          </li>
          <li class="on-screen">
            <a href="#error-topics" class="toc-h1 toc-link" data-title="Error Topics">
              Error Topics
                <span class="menu-arrow">
                  <svg width="18" height="18" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1171 960q0 13-10 23l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23z"/></svg>
                  <!-- <span>&gt;</span> -->
                </span>
            </a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#username-errors" class="toc-h2 toc-link" data-title="{username}/errors">{username}/errors</a>
                  </li>
                  <li>
                    <a href="#username-throttle" class="toc-h2 toc-link" data-title="{username}/throttle">{username}/throttle</a>
                  </li>
                  <li>
                    <a href="#adafruit-io-monitor" class="toc-h2 toc-link" data-title="Adafruit IO Monitor">Adafruit IO Monitor</a>
                  </li>
              </ul>
          </li>
          <li class="on-screen">
            <a href="#troubleshooting" class="toc-h1 toc-link" data-title="Troubleshooting">
              Troubleshooting
                <span class="menu-arrow">
                  <svg width="18" height="18" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1171 960q0 13-10 23l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23z"/></svg>
                  <!-- <span>&gt;</span> -->
                </span>
            </a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#understanding-error-messages" class="toc-h2 toc-link" data-title="Understanding Error Messages">Understanding Error Messages</a>
                  </li>
                  <li>
                    <a href="#writing-safe-mqtt-code" class="toc-h2 toc-link" data-title="Writing Safe MQTT Code">Writing Safe MQTT Code</a>
                  </li>
              </ul>
          </li>

            <li>
<a href="cookbook.html" class="toc-h1 toc-link append">                API Cookbook
                <i class="fa fa-external-link"></i>
</a>            </li>

      </ul>
        <ul class="toc-footer">
            <li><a href='http://io.adafruit.com'>Adafruit IO</a></li>
            <li><a href='https://io.adafruit.com/blog'>Adafruit IO News</a></li>
            <li><a href='https://io.adafruit.com/plus'>Adafruit IO Plus</a></li>
            <li><a href='https://io.adafruit.com/terms'>Adafruit IO ToS</a></li>
            <li><a href='https://io.adafruit.com/feedback'>Submit Feedback</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>

      <div class="content">
        <h1 id='adafruit-io-mqtt-api'>Adafruit IO MQTT API</h1>
<p><a href="http://mqtt.org/">MQTT</a>, or message queue telemetry transport, is a protocol for device communication that Adafruit IO supports. Using a MQTT library or client you can publish and subscribe to a feed to send and receive feed data.</p>

<p>If you aren&#39;t familiar with MQTT check out this <a href="http://www.hivemq.com/mqtt-essentials-part-1-introducing-mqtt/">introduction from the HiveMQ blog</a>.
All of the subsequent posts in the <a href="http://www.hivemq.com/mqtt-essentials-wrap-up/">MQTT essentials series</a> are great and worth reading too.</p>
<h2 id='client-libraries'>Client Libraries</h2>
<p>To use the MQTT API that Adafruit IO exposes you&#39;ll need a MQTT client library.  For Python, Ruby, and Arduino you can use Adafruit&#39;s
IO libraries as they include support for MQTT. For other languages or platforms look for a MQTT library that ideally supports the MQTT 3.1.1 protocol.</p>

<ul>
<li><p><strong>Arduino</strong>: <a href="https://github.com/adafruit/Adafruit_MQTT_Library">Adafruit MQTT</a></p></li>
<li><p><strong>Python</strong>: <a href="https://github.com/adafruit/Adafruit_IO_Python">Adafruit IO Python</a> includes an MQTT Client.</p></li>
<li><p><strong>CircuitPython</strong>: <a href="https://github.com/adafruit/Adafruit_CircuitPython_AdafruitIO/">Adafruit IO CircuitPython</a> includes a MQTT Client class, <code>IO_MQTT</code>.</p></li>
<li><p><strong>MicroPython</strong>: MicroPython devices can connect to Adafruit IO using <a href="https://github.com/micropython/micropython-lib/tree/master/umqtt.simple">uMQTT</a></p></li>
<li><p><strong>Ruby</strong>: <a href="https://github.com/adafruit/io-client-ruby">Adafruit IO Ruby</a> includes an MQTT client.</p></li>
</ul>
<h2 id='mqtt-connection-details'>MQTT Connection Details</h2>
<p>We <em>strongly</em> recommend connecting using SSL (Port 8883) if your client allows it.  Port 443 is for MQTT-over-Websockets
clients which generally run in browsers, like Eclipse Paho, HiveMQ Websockets, or MQTTJS.</p>

<table><thead>
<tr>
<th></th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td><strong>Host</strong></td>
<td>io.adafruit.com</td>
</tr>
<tr>
<td><strong>Secure (SSL) Port</strong></td>
<td>8883</td>
</tr>
<tr>
<td><strong>Insecure Port</strong></td>
<td>1883</td>
</tr>
<tr>
<td>**MQTT over Websocket</td>
<td>443</td>
</tr>
<tr>
<td><strong>Username</strong></td>
<td>Your Adafruit IO Username</td>
</tr>
<tr>
<td><strong>Password</strong></td>
<td>Your Adafruit IO Key</td>
</tr>
</tbody></table>

<p><em>Need to manually set a Client ID for your MQTT client?</em> Use a unique value such as a <a href="https://www.guidgenerator.com/online-guid-generator.aspx">random GUID</a>. Whenever possible, leave the client ID field blank.</p>

<aside class="notice">
Connecting to Adafruit IO via MQTT and reusing the client ID of an existing connection will result in <strong>immediate disconnection</strong> of the other MQTT client. The MQTT specification requires that "each client connecting to the server has a unique ClientId." <a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/csprd02/mqtt-v3.1.1-csprd02.html#_Toc385349767">link</a>
</aside>

<p>We do not currently limit the number of clients that can connect to Adafruit IO, but we do limit the rate at which connections may be attempted to 20 per minute. Exceeding the connection attempt rate limit will result in a temporary ban.</p>
<h1 id='mqtt-qos'>MQTT QoS</h1>
<p>One feature of MQTT is the ability to specify a QoS, or quality of service, level when publishing feed data.  This allows an application to confirm that its data has been sucessfully published.</p>

<p>If you aren&#39;t familiar with MQTT QoS levels <a href="http://www.hivemq.com/mqtt-essentials-part-6-mqtt-quality-of-service-levels/">be sure to read this great blog post</a> explaining their meaning.</p>

<p>For publishing feed values <strong>the Adafruit IO MQTT API supports QoS level 0 (at most once) and 1 (at least once) only</strong>.</p>

<p>QoS level 2 (exactly once) is <em>not</em> currently supported.</p>
<h1 id='mqtt-api-rate-limiting'>MQTT API Rate Limiting</h1>
<p>Adafruit IO&#39;s MQTT server imposes a rate limit to prevent excessive load on the service.  If a user performs too many <strong>publish</strong> actions in a short period of time then some of the requests will be rejected and an error message will be published on <a href="#error-topics">your /throttle topic</a>. The current rate limit is at most 30 requests per minute for free accounts, 60 per minute with an IO+ account, and expandable via Adafruit IO+ Boost applied to your account.</p>

<p>We also limit a few other actions on Adafruit IO&#39;s MQTT broker. If you send, within a minute, more than: 100 MQTT SUBSCRIBE requests, 10 <em>failed</em> MQTT SUBSCRIBE requests, or 10 <em>failed</em> MQTT PUBLISH requests; or you send enough messages after passing the rate limit; or you attempt to log in more than 20 times within a minute, your account will be temporarily banned from the MQTT broker.</p>

<p>Most of the systems connecting to Adafruit IO are simple, automated devices and MQTT client scripts. A runaway ESP8266 sending MQTT SUBSCRIBE packets inside the main <code>loop()</code> function of an Arduino sketch can send about 500 packets per minute. It wouldn&#39;t take many poorly written clients connecting to our MQTT broker to crash the service for everyone if we didn&#39;t add rate limits to every action.</p>

<p>If you exceed a rate limit, a notice will be sent to the <code>(username)/throttle</code> topic. If your account is temporarily banned, a notice will be sent to the <code>{username}/errors</code> topic. While developing your project, you should always keep subscriptions to the error topics open so you can see when you&#39;re getting close to the Adafruit IO rate limits and when you&#39;ve been blocked.</p>

<p>This limit applies to all connections so if you have multiple devices or clients publishing data be sure to delay their updates enough that the total rate is below 2 requests/second.</p>
<h2 id='rate-limit-bans'>Rate Limit Bans</h2>
<p>Temporary MQTT bans start at 30 seconds and scale as a multiple of the number of bans within the last hour up to one hour maximum. For example, 10 rejected MQTT SUBSCRIBE requests will trigger a temporary ban of 30 seconds, that&#39;s 1 ban. If it&#39;s a device that automatically wakes up, connects to Adafruit IO, and sends a stream of rejected SUBSCRIBE packets, it will be banned again. The second ban results in 60 seconds offline, the third is 90 seconds, and so on.</p>

<p>You can visit your Adafruit IO monitor page any time</p>
<h2 id='preventing-mqtt-bans'>Preventing MQTT Bans</h2>
<p>A misbehaving MQTT device--for example, a device configured for a different MQTT broker like Home Assistant--that attempts to publish to invalid Adafruit IO MQTT topics can lock <em>every</em> device and browser session out of your Adafruit IO MQTT account for an hour at a time.</p>

<p>The easiest way to prevent a temporary or permanent MQTT block being put against your account is to delay how frequently your MQTT client sends messages.</p>

<p>The second thing to check is that you are not using a different Internet of Things software toolkit to talk to Adafruit IO. The Adafruit IO MQTT broker</p>
<h1 id='mqtt-data-format'>MQTT Data Format</h1>
<p>There are a few ways to send data to our MQTT API if you&#39;re writing your own client library.</p>

<p>The simplest way to send values to an IO Feed topic is to just send the value.  For example, a temperature sensor is going to produce numeric values like <code>22.587</code>.  If you&#39;re sending to <code>mosfet/feeds/photocell-one</code> you can use the raw number or a string. That means either <code>22.587</code> or <code>22.587</code> will be accepted as a numeric value. Adafruit IO does its best to treat data as numeric values so that we can show you your data as a chart on an Adafruit IO dashboard and through our <a href="https://io.adafruit.com/api/docs/#!/Data/chartData">Charting API</a>.</p>
<h2 id='sending-data-with-location'>Sending data with location</h2>
<p>To tag your data with a location value, you&#39;ll either need to wrap it in a JSON object first or send it to the special <code>/csv</code> formatted MQTT topic.</p>
<h2 id='sending-json'>Sending JSON</h2>
<p>JSON can be sent to either the base topic or the /json topic - for example <code>mosfet/feeds/photocell-one</code> or <code>mosfet/feeds/photocell-one/json</code>.
The proper format for location tagged JSON data is:</p>

<p>Example JSON topic object:</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span> <span class="mf">22.587</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">lat</span><span class="dl">"</span><span class="p">:</span> <span class="mf">38.1123</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">lon</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">91.2325</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ele</span><span class="dl">"</span><span class="p">:</span> <span class="mi">112</span>
<span class="p">}</span>
</code></pre></div>
<p>Specifically, JSON objects must include a <code>value</code> key, and may include <code>lat</code>, <code>lon</code>, and <code>ele</code> keys.</p>
<h2 id='sending-csv'>Sending CSV</h2>
<p>Alternatively, you can send location tagged data to <code>/csv</code> topics. In this example, that would be the topic <code>mosfet/feeds/photocell-one/csv</code> instead of <code>mosfet/feeds/photocell-one</code>. Both store data in the same feed. The format IO expects for location tagged CSV data is VALUE, LATITUDE, LONGITUDE, ELEVATION.</p>

<p>With the example data shown before, that means you could publish the string <code>&quot;22.587,38.1123,-91.2325,112&quot;</code> to <code>mosfet/feeds/photocell-one/csv</code>. to store the value <code>&quot;22.587&quot;</code> in the location <code>latitude: 38.1123</code>, <code>longitude: -91.2325</code>, <code>elevation: 112</code>.</p>

<p>An example is displayed below, which uses a simple Ruby MQTT library and the data shown, all these examples publish the same data to the same feed.</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="c1"># first you'll need https://github.com/njh/ruby-mqtt</span>
<span class="nb">require</span> <span class="s1">'mqtt'</span>

<span class="n">username</span> <span class="o">=</span> <span class="s1">'test_username'</span>
<span class="n">key</span>      <span class="o">=</span> <span class="s1">'not-a-real-key'</span>
<span class="n">url</span>      <span class="o">=</span> <span class="s2">"mqtts://</span><span class="si">#{</span> <span class="n">username</span> <span class="si">}</span><span class="s2">:</span><span class="si">#{</span> <span class="n">key</span> <span class="si">}</span><span class="s2">@io.adafruit.com"</span>

<span class="n">mqtt_client</span> <span class="o">=</span> <span class="no">MQTT</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="mi">8883</span><span class="p">)</span>

<span class="c1"># simplest thing that could possibly work</span>
<span class="n">mqtt_client</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="s1">'test_username/feeds/example'</span><span class="p">,</span> <span class="mf">22.587</span><span class="p">)</span>

<span class="c1"># sending numbers as strings is fine, IO stores all data internally</span>
<span class="c1"># as strings anyways</span>
<span class="n">mqtt_client</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="s1">'test_username/feeds/example'</span><span class="p">,</span> <span class="s1">'22.587'</span><span class="p">)</span>

<span class="c1"># CSV formatted, no location</span>
<span class="n">mqtt_client</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="s1">'test_username/feeds/example/csv'</span><span class="p">,</span> <span class="s1">'22.587'</span><span class="p">)</span>

<span class="c1"># CSV formatted, with location</span>
<span class="n">mqtt_client</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="s1">'test_username/feeds/example/csv'</span><span class="p">,</span>
                  <span class="s1">'22.587,38.1123,-91.2325,112'</span><span class="p">)</span>

<span class="c1"># JSON formatted, no location</span>
<span class="n">mqtt_client</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="s1">'test_username/feeds/example'</span><span class="p">,</span> <span class="s1">'{"value":22.587}'</span><span class="p">)</span>
<span class="n">mqtt_client</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="s1">'test_username/feeds/example/json'</span><span class="p">,</span> <span class="s1">'{"value":22.587}'</span><span class="p">)</span>

<span class="c1"># JSON formatted, with location</span>
<span class="n">mqtt_client</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="s1">'test_username/feeds/example'</span><span class="p">,</span>
<span class="s1">'{"value":22.587,"lat":38.1123,"lon":-91.2325,"ele":112}'</span><span class="p">)</span>
<span class="n">mqtt_client</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="s1">'test_username/feeds/example/json'</span><span class="p">,</span>
<span class="s1">'{"value":22.587,"lat":38.1123,"lon":-91.2325,"ele":112}'</span><span class="p">)</span>
</code></pre></div><h2 id='sending-json-data-through-adafruit-io'>Sending JSON Data through Adafruit IO</h2>
<p>Because Adafruit IO supports additional features beyond a basic MQTT brokering service, such as location tagging for data points,
the service supports data in the JSON format described above. Namely, the example JSON response on the sidebar.</p>

<p>JSON Response Format Example</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code>  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span> <span class="mf">22.587</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">lat</span><span class="dl">"</span><span class="p">:</span> <span class="mf">38.1123</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">lon</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">91.2325</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">ele</span><span class="dl">"</span><span class="p">:</span> <span class="mi">112</span>
  <span class="p">}</span>
</code></pre></div>
<p>This lets us store the individual value, <code>22.587</code>, and data about the value: its latitude, longitude, and elevation. Metadata!</p>

<p>But what happens when the value you want to send is itself JSON? Good news! There are a few solutions available to you in that situation.</p>
<h3 id='io-formatted-json'>IO-Formatted JSON</h3>
<p>The simplest way to send JSON data to Adafruit IO is to wrap it in the format described above. For example, if instead of <code>22.587</code>, I wanted to send something like, <code>{&quot;sensor-1&quot;:22.587,&quot;sensor-2&quot;:13.182}</code>, the &quot;wrapped&quot; version would look like this:</p>

<p>Example of IO-Formatted JSON</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">sensor-1</span><span class="dl">"</span><span class="p">:</span><span class="mf">22.587</span><span class="p">,</span><span class="dl">"</span><span class="s2">sensor-2</span><span class="dl">"</span><span class="p">:</span><span class="mf">13.182</span><span class="p">},</span>
  <span class="dl">"</span><span class="s2">lat</span><span class="dl">"</span><span class="p">:</span> <span class="mf">38.1123</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">lon</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">91.2325</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ele</span><span class="dl">"</span><span class="p">:</span> <span class="mi">112</span>
<span class="p">}</span>
</code></pre></div>
<p>It&#39;s worth noting that because Adafruit IO parses the entire JSON object that you send it, any valid JSON will be parsed and when it is stored in our system and forwarded to any subscribers, it will be regenerated. The significance of that is that if you publish JSON data with whitespace, it will be stored and republished without whitespace, because our generator produces the most compact JSON format possible.</p>
<h3 id='double-encoded-json-strings'>Double-Encoded JSON Strings</h3>
<p>The second way you can send JSON data as a value is to &quot;double encode&quot; it before sending, in which case IO will treat it as a raw string.
If you&#39;re using something like javascript&#39;s <code>JSON.stringify</code> function or Ruby&#39;s <code>JSON.generate</code>, double encoding means passing the result of
<code>JSON.stringify</code> through <code>JSON.stringify</code> a second time. In this node.js console example, you can see the difference:</p>

<p>Here&#39;s an example of sending double-encoded strings through Adafruit IO:</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="o">&gt;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="dl">"</span><span class="s2">sensor-1</span><span class="dl">"</span><span class="p">:</span><span class="mf">22.587</span><span class="p">,</span><span class="dl">"</span><span class="s2">sensor-2</span><span class="dl">"</span><span class="p">:</span><span class="mf">13.182</span><span class="p">})</span>
<span class="dl">'</span><span class="s1">{"sensor-1":22.587,"sensor-2":13.182}</span><span class="dl">'</span>
<span class="o">&gt;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="dl">"</span><span class="s2">sensor-1</span><span class="dl">"</span><span class="p">:</span><span class="mf">22.587</span><span class="p">,</span><span class="dl">"</span><span class="s2">sensor-2</span><span class="dl">"</span><span class="p">:</span><span class="mf">13.182</span><span class="p">}))</span>
<span class="dl">'</span><span class="s1">"{</span><span class="se">\</span><span class="s1">"sensor-1</span><span class="se">\</span><span class="s1">":22.587,</span><span class="se">\</span><span class="s1">"sensor-2</span><span class="se">\</span><span class="s1">":13.182}"</span><span class="dl">'</span>
</code></pre></div>
<p>The double encoded JSON string can be sent directly through Adafruit IO without interference from our processing system, because the processing system will not interpret it as JSON. In your receiving code, because the value passed through includes surrounding double quotes, you have to call your parse function twice to restore the JSON object.</p>

<p>Here&#39;s an example of interpreting double-encoded JSON Strings sent through Adafruit IO:</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">"{</span><span class="se">\\\</span><span class="s1">"sensor-1</span><span class="se">\\\</span><span class="s1">":22.587,</span><span class="se">\\\</span><span class="s1">"sensor-2</span><span class="se">\\\</span><span class="s1">":13.182}"</span><span class="dl">'</span>
<span class="o">&gt;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">input</span><span class="p">))</span>
<span class="p">{</span> <span class="dl">'</span><span class="s1">sensor-1</span><span class="dl">'</span><span class="p">:</span> <span class="mf">22.587</span><span class="p">,</span> <span class="dl">'</span><span class="s1">sensor-2</span><span class="dl">'</span><span class="p">:</span> <span class="mf">13.182</span> <span class="p">}</span>
</code></pre></div><h3 id='non-io-formatted-json'>Non-IO Formatted JSON</h3>
<p>The third way you can send raw JSON data is to just send it. If Adafruit IO doesn&#39;t find a &quot;value&quot; key in the JSON object you send,
it will treat the whole blob as plain text and store and forward the data. That means with our example JSON object,
sending the string <code>{&quot;sensor-1&quot;:22.587,&quot;sensor-2&quot;:13.182}</code> will result in <code>{&quot;sensor-1&quot;:22.587,&quot;sensor-2&quot;:13.182}</code> being stored in IO and sent
to MQTT subscribers.</p>
<h1 id='retained-values'>Retained values</h1>
<p>MQTT is a tremendously useful protocol for building small connected devices and is relatively simple to understand and implement (if implementing networking protocols is your thing). Unfortunately, a few features of the Adafruit IO platform make it difficult for us to support the entire MQTT 3.1+ protocol specification in our broker. Specifically, one particular feature, the publish retain flag.</p>
<h2 id='mqtt-retain'>MQTT Retain</h2>
<p>In the MQTT protocol, setting the <code>retain</code> flag on a published message asks the MQTT broker (server) to store that message.  Then any new clients which connect and subscribe to that topic will immediately receive the retained message. Retain makes writing basic MQTT-only Internet of Things clients easier, without it, a client that connects and subscribes to a feed topic has to wait until a new value is published on the feed to know what state it should be in. In the case of slowly updated feeds, there could be hours between updates which means a device that disconnects and reconnects (for example, due to power cycling or sleeping) might lose the current value for a long time between updates.</p>
<h2 id='adafruit-io-39-s-limitations'>Adafruit IO&#39;s Limitations</h2>
<p>Among other factors, our scale, Adafruit IO&#39;s mix of MQTT &amp; HTTP APIs, the speed at which we’re taking in new data, and the fact that we’re already storing almost every message that is sent mean that a “simple” feature like retain becomes difficult to support without making MQTT service performance worse for everyone.</p>

<p>Since we don’t actually store data in the broker but at a lower level and can’t support PUBLISH retain directly, we’re proposing a different solution for the retaining problem: the <code>/get</code> topic modifier.</p>
<h2 id='using-the-get-topic'>Using the */get topic</h2>
<p>For any given Adafruit IO MQTT feed or group, subscribe to the appropriate topic using the feed or group <strong>key</strong>, then add <code>/get</code> to the topic you subscribed to and publish anything to that new topic (our Arduino library uses the null character: <code>\0</code>). IO will immediately publish, just for that client, the most recent value received on the feed.</p>

<p>For example, let&#39;s imagine we have a device that subscribes to a counter feed: <code>uname/f/counter</code>. If we want to get the latest value, the <code>/get</code> topic we should publish to is <code>uname/f/counter/get</code>. After connecting to IO, subscribing to <code>uname/f/counter</code>, and publishing <code></code> to <code>uname/f/counter/get</code>, we will immediately receive a message on our <code>uname/f/counter</code> subscription with the last value that was published to <code>counter</code>.</p>

<p>If you’re using the Adafruit IO Arduino library, you can add <code>/get</code> support to your project in one line of code:</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight cpp tab-cpp"><code><span class="c1">// ... from the adafruitio_01_subscribe example sketch</span>
<span class="n">AdafruitIO_Feed</span> <span class="o">*</span><span class="n">counter</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">feed</span><span class="p">(</span><span class="s">"counter"</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 1. start IO connection</span>
  <span class="n">io</span><span class="p">.</span><span class="n">connect</span><span class="p">();</span>

  <span class="c1">// 2. prepare MQTT subscription with handler function</span>
  <span class="n">counter</span><span class="o">-&gt;</span><span class="n">onMessage</span><span class="p">(</span><span class="n">handleMessage</span><span class="p">);</span>

  <span class="c1">// 3. wait for successful connection</span>
  <span class="k">while</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">mqttStatus</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">AIO_CONNECTED</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 4. send /get message, requesting last value, triggering</span>
  <span class="c1">//    the handleMessage handler function</span>
  <span class="n">counter</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">();</span> <span class="c1">// ask Adafruit IO to resend the last value</span>
<span class="p">}</span>
<span class="c1">// ....</span>
</code></pre></div>
<p>You can also perform a <code>/get</code> using the Adafruit IO CircuitPython library in one line of code:
<div class="center-column"></div>
<code>python
io.get(&#39;temperature&#39;)
</code></p>
<h1 id='mqtt-topics'>MQTT Topics</h1><h2 id='feed-topic-format'>Feed Topic Format</h2>
<p>Adafruit IO&#39;s MQTT API exposes feed data using special topics. You can publish a new value for a feed to its topic, or you
can subscribe to a feed&#39;s topic to be notified when the feed has a new value.</p>

<ul>
<li><code>{your Adafruit IO username}/feeds/{feed key}</code></li>
<li><code>{your Adafruit IO username}/feeds/{feed key}/csv</code></li>
<li><code>{your Adafruit IO username}/feeds/{feed key}/json</code></li>
</ul>
<h2 id='group-topic-format'>Group Topic Format</h2>
<ul>
<li><code>{your Adafruit IO username}/groups/{group key}</code></li>
<li><code>{your Adafruit IO username}/groups/{group key}/csv</code></li>
<li><code>{your Adafruit IO username}/groups/{group key}/json</code></li>
</ul>
<h2 id='small-topic-format'>Small Topic Format</h2>
<p>If you&#39;re using an embedded system and need to conserve space, use the <code>/f/</code> or <code>/g/</code> topic formats:</p>

<ul>
<li><code>{your Adafruit IO username}/g/{group key}</code></li>
<li><code>{your Adafruit IO username}/g/{group key}/csv</code></li>
<li><code>{your Adafruit IO username}/g/{group key}/json</code></li>
<li><code>{your Adafruit IO username}/f/{feed key}</code></li>
<li><code>{your Adafruit IO username}/f/{feed key}/csv</code></li>
<li><code>{your Adafruit IO username}/f/{feed key}/json</code></li>
</ul>
<h2 id='using-a-wildcard'>Using a Wildcard</h2>
<p>You can also subscribe to the parent &#39;feeds&#39; path to be notified when any owned feed changes using MQTT&#39;s <code>#</code> wildcard character.  For example, the user could subscribe to either:</p>

<ul>
<li><code>{your Adafruit IO username}/feeds/#</code></li>
<li><code>{your Adafruit IO username}/f/#</code></li>
</ul>

<p>Once subscribed to the path above any change to a feed owned by <code>Your_Adafruit_IO_Username</code> will be sent to the MQTT client.  The topic will specify the feed that was updated, and the payload will have the new value.</p>

<p><strong>Be aware the MQTT server sends feed updates on all possible paths for a specific feed</strong>. For example, subscribing to <code>IO-Username/f/#</code> and publishing to <code>IO-Username/f/photocell-one</code> would produce messages from: <code>IO-Username/f/photocell-one</code>, <code>IO-Username/f/photocell-one/json</code>, and <code>IO-Username/f/photocell-one/csv</code>; each referring to the same updated value.  To reduce noise, <em>make sure to grab the specific topic</em> of the feed <code>/</code> format you&#39;re interested in and change your subscription to that.</p>

<p>If you&#39;d like to avoid the formatted feeds (<code>/json</code> and <code>/csv</code> topics) <em>but still see all the feeds you&#39;re publishing to</em>, you can use MQTT&#39;s <code>+</code> wildcard in place of <code>#</code>. In this case, subscribing to <code>IO-Username/f/+</code> would produce output on <code>IO-Username/f/photocell-one</code>, but <em>not</em> <code>IO-Username/f/photocell-one/json</code>.</p>
<h1 id='group-topics'>Group Topics</h1>
<p>You aren&#39;t limited to just Feed based MQTT topics, Adafruit IO supports grouped feeds as well.  <a href="https://io.adafruit.com/api/docs/#operation/createGroupData">Similar to our HTTP group data creation API</a>, you can publish to multiple feeds or subscribe to multiple feeds through a single MQTT topic.</p>

<p>The topics formats for publishing or subscribing are:</p>

<ul>
<li>  <code>(username)/groups/(group name or key)</code></li>
<li>  <code>(username)/groups/(group name or key)/json</code></li>
<li>  <code>(username)/groups/(group name or key)/csv</code></li>
</ul>
<h3 id='publish-to-feeds-in-a-group'>Publish to Feeds in a Group</h3>
<p>If you use the <code>/json</code> or <code>/csv</code> endings on your group MQTT topic, your data should be formatted in JSON or CSV, respectively. By default, IO expects published values to be in JSON format.</p>

<p>The JSON and CSV format IO expects are displayed below:</p>

<p>JSON Expected Response from Adafruit IO</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"feeds"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key-1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value 1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key-2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value 2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key-3"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value 3"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"lat"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lon"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ele"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>CSV Format Expected Response from Adafruit IO</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight plaintext"><code>key-1,value 1
key-2,value 2
key-3,value 3
location,0.0,0.0,0.0
</code></pre></div><h2 id='group-guidelines'>Group Guidelines</h2>
<ul>
<li>  In each payload format, <code>key-1</code> represents the respective feed&#39;s key and <code>value 1</code> represents the value you&#39;d like to publish to that feed.</li>
<li>  For CSV location values, the location is interpreted as <code>lat</code>, <code>lon</code>, <code>ele</code> and <code>ele</code> is optional <code>/</code> not required.</li>
<li>  Any number of feeds present in the group may be included.</li>
<li>  Each value may be either a string or a number.</li>
<li>  If any feed key is included that does not already belong to a feed in the group, then a new feed with the given key as its name will be created.</li>
</ul>
<h3 id='subscribing-to-groups'>Subscribing to groups</h3>
<p>If you use the <code>/json</code> or <code>/csv</code> endings when subscribing to your group MQTT topic, your data will be formatted in JSON or CSV, respectively. By default, IO publishes values in JSON format.</p>

<p>The formats your subscription will receive are the same as the formats IO expects to receive. Expected responses for JSON and CSV are below.</p>

<p>Expected Group JSON Response</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"feeds"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key-1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value 1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key-2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value 2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key-3"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value 3"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"lat"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lon"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ele"</span><span class="p">:</span><span class="w"> </span><span class="mf">3.0</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>Expected Group CSV Response</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight plaintext"><code>key-1,value 1
key-2,value 2
key-3,value 3
location,1.0,2.0,3.0
</code></pre></div>
<p>It&#39;s important to note that you will only receive updated values for the feeds that received new values. That means if you&#39;re subscribed to  <code>{username}/groups/example</code>  and publish to  <code>{username}/feeds/key-1</code>, the subscription will receive:</p>

<div class="center-column"></div>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"feeds"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key-1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value 1"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>It&#39;s also worth noting that JSON subscription formats will always receive string type values, regardless of whether a string or number was published.</p>
<h1 id='time-topics'>Time Topics</h1>
<p>Adafruit IO provides some built-in MQTT topics for getting the current server time. The current available topics are:</p>

<ul>
<li><code>time/seconds</code></li>
<li><code>time/millis</code></li>
<li><code>time/ISO-8601</code></li>
<li><code>time/hours</code></li>
</ul>

<p>Most of the Adafruit IO client libraries provide helper functions for easy use of these topics:</p>

<ul>
<li><a href="https://github.com/adafruit/Adafruit_IO_Arduino/blob/master/examples/adafruitio_17_time_subscribe/adafruitio_17_time_subscribe.ino">Arduino</a></li>
<li><a href="https://github.com/adafruit/Adafruit_IO_Python/blob/master/examples/mqtt/mqtt_time.py">Python</a></li>
<li><a href="https://github.com/adafruit/Adafruit_CircuitPython_AdafruitIO/blob/master/examples/adafruit_io_mqtt/adafruit_io_time.py">CircuitPython</a></li>
</ul>
<h2 id='time-seconds'>time/seconds</h2>
<p>This topic publishes the current time in <a href="https://en.wikipedia.org/wiki/Unix_time">Unix epoch seconds</a>.</p>

<p>The current Unix epoch time at the time of writing is: <code>1562164754</code>.</p>
<h2 id='time-millis'>time/millis</h2>
<p>This topic publishes the same thing as time/seconds every second, but with slightly higher precision and more digits.</p>

<p>The current Unix epoch time in milliseconds at the time of writing is: <code>1562165081839</code></p>
<h2 id='time-iso-8601'>time/ISO-8601</h2>
<p>This topic publishes the current time in <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601 UTC format</a>. That&#39;s <code>year-month-dayThour:minute:second.millisecondsZ</code> where &quot;-&quot;, &quot;:&quot;, &quot;T&quot;, and &quot;Z&quot; are character literals / always included in the time string.</p>

<p>The current time in ISO 8601 UTC format at the time of writing is: <code>2019-07-03T14:47:16.038Z</code></p>
<h2 id='time-hours'>time/hours</h2>
<p>This topic publishes the current hour of the day in 24 hour format (the values 0 - 23) in the UTC time zone. It only publishes once every hour.</p>
<h1 id='randomizer-topics'>Randomizer Topics</h1>
<p>Create random data streams that can generate colors, words, numbers, or pick a value from a custom data set and send it directly to your devices.</p>

<p>Prior to subcribing to the randomizer topic, you need to <a href="https://io.adafruit.com/services/words">generate the topics</a> to get the id.</p>
<h2 id='subscribe-to-the-generated-topic'>Subscribe to the Generated Topic</h2>
<ul>
<li><code>{username}/integrations/words/{generated topic id}</code></li>
</ul>

<p>MQTT random word subscriptions will publish data once per minute to every client that is subscribed to the same topic.</p>
<h1 id='error-topics'>Error Topics</h1>
<p>Adafruit IO provides two error reporting MQTT topics you can subscribe to:</p>

<ul>
<li><code>{username}/errors</code></li>
<li><code>{username}/throttle</code></li>
</ul>
<h2 id='username-errors'>{username}/errors</h2>
<p>This topic publishes error messages related to publishing and subscribing to Adafruit IO feeds. Because MQTT is an asynchronous and compact messaging format, we cannot respond to invalid PUBLISH or SUBSCRIBE packets with a comprehensive error message, so we use this topic to update subscribers when an error occurs.</p>

<p>You may only subscribe to your personal errors feed.</p>
<h2 id='username-throttle'>{username}/throttle</h2>
<p>This topic publishes throttle warning and error messages to all subscribed clients. We do our best to provide an accurate accounting in the error message of the minimum amount of time you should wait before attempting to publish again.</p>

<p>Be warned: exceeding the rate limit too often within a short time span will result in a temporary ban from the Adafruit IO MQTT service.</p>

<p>You may only subscribe to your personal throttle feed.</p>
<h2 id='adafruit-io-monitor'>Adafruit IO Monitor</h2>
<p>Both error feeds can be seen live on <a href="https://io.adafruit.com/monitor">your Adafruit IO Monitor page</a>.</p>
<h1 id='troubleshooting'>Troubleshooting</h1>
<p>What can you do when something is going wrong with your project? Adafruit IO provides a few ways for you to find out what&#39;s happening behind the scenes with your MQTT connected devices.</p>
<h2 id='understanding-error-messages'>Understanding Error Messages</h2>
<p>The two <a href="#error-topics">MQTT error topics</a> produce alerts, warnings, and error messages when there&#39;s a problem with your MQTT data. MQTT error messages are <strong>not stored permanently</strong>, so if you want to see them you&#39;ll need to keep the monitor page open while developing your project.</p>

<p>We try to be descriptive enough that you can figure out what went wrong, but there are a few categories of error messages you may run into. We list an example message for each category of error, yours will look different but most are in the form:</p>

<p><code>CLIENT_ID IP_ADDRESS MQTT_ACTION MQTT_TOPIC ...message</code></p>
<h3 id='exceeded-rate-limit'>Exceeded Rate Limit</h3>
<p>On <code>{username}/throttle</code>:</p>

<p>When MQTT packets are arriving too quickly (SUBSCRIBE only, warning):</p>

<p class='error-message-sample'>io-badstuff-23111 172.18.0.1 SUBSCRIBE time/seconds only 5 attempts remaining in the next 60 seconds, please slow your request rate</p>

<p>When publishing data too quickly (warning): <p class='error-message-sample'>test_username data rate limit reached, 21 seconds until throttle released</p></p>

<p>On <code>{username}/errors</code>:</p>

<p>When MQTT packets are arriving too quickly (SUBSCRIBE only, error):  <p class='error-message-sample'>io-badstuff-23111 172.18.0.1 SUBSCRIBE time/seconds made too many requests, wait before reconnecting</p></p>

<p>After a certain number of throttle warning messages have been sent: <p class='error-message-sample'>enforcement limit reached, your account is banned for 30 seconds</p></p>
<h3 id='invalid-mqtt-topic'>Invalid MQTT topic</h3>
<p>There are several variations of invalid MQTT topic errors. All error messages will be published on the <code>{username}/errors</code> topic.</p>

<p>When making a PUBLISH or SUBSCRIBE request for an MQTT topic not recognized by Adafruit IO: <p class='error-message-sample'>io-badstuff-12558 172.18.0.1 SUBSCRIBE LWT/$SYS/obe/pixel/adafruit.server/sessions-005 rejected, not a valid resource topic</p></p>

<p>Sometimes invalid MQTT topics or topics that don&#39;t fit the <code>{username}/{type}/{key}/{format}</code> pattern can look like a different error to IO. The most common is seeing an error message like this when PUBLISHING: <p class='error-message-sample'>io-mqtt-149edf5e 172.18.0.1 PUBLISH ,,21,9,,,33,, OK -72.223332,12.100,0.17,28.1,1,, rejected, only shared feeds may be published to</p></p>

<p>Or: <p class='error-message-sample'>io-mqtt-149edf5e 172.18.0.1 PUBLISH  rejected, only shared feeds may be published to</p></p>

<p>In each case, IO is showing the topic your code specified in between &quot;PUBLISH&quot; and &quot;rejected.&quot; In the first example, the given topic was <code>,,21,9,,,33,, OK -72.223332,12.100,0.17,28.1,1,,</code> and in the second example, the given topic was an empty string, <code></code>. Both examples probably mean there was an error in the sketch that caused the MQTT topic to become corrupted in memory before publishing data.</p>

<p>A good idea if you&#39;re getting <em>any</em> error messages when publishing or subscribing from a new sketch is to print out the MQTT topic you&#39;re using to the serial console (<code>Serial.println</code> in Arduino, <code>print()</code> in CircuitPython) in your sketch before you publish or subscribe just to make sure the data you&#39;re sending is the data you think you&#39;re sending.</p>

<p>The meaning of the error message, &quot;rejected, only shared feeds may be published to&quot;, is that IO saw a username other than the one you authenticated with in the <code>{username}</code> part of an MQTT topic and something other than &quot;feeds&quot; or &quot;f&quot; in the <code>{type}</code> part of an MQTT topic. Because the topic part of the MQTT packet IO received was, <code>,,21,9,,,33,, OK -72.223332,12.100,0.17,28.1,1,,</code> IO couldn&#39;t find a username or a type in the string, so it had to reject the PUBLISH message.</p>
<h3 id='mqtt-action-flood'>MQTT action flood</h3>
<p>On <code>{username}/errors</code>:</p>

<p>When subscribing or publishing to resources faster than IO can verify that you have permission to access them: <p class='error-message-sample'>io-badstuff-94864 172.18.0.1 SUBSCRIBE time/seconds request flood, disconnecting</p></p>
<h3 id='resource-not-available'>Resource not available</h3>
<p>On <code>{username}/errors</code>:</p>

<p>When you don&#39;t have permission to access a shared resource: <p class='error-message-sample'>io-badstuff-29349 172.18.0.1 SUBSCRIBE other_username/feeds/something.fake-11 rejected, resource not available or not authorized</p></p>
<h3 id='action-attempted-while-banned'>Action attempted while banned</h3>
<p>On <code>{username}/errors</code>:</p>

<p>When attempting to publish or subscribe after your account has been temporarily banned: <p class='error-message-sample'>io-mqtt-0d63acfb 172.18.0.1 PUBLISH test_username/feeds/example.counter-3 rejected, user is temporarily blocked</p></p>
<h2 id='writing-safe-mqtt-code'>Writing Safe MQTT Code</h2>
<p><strong>Always. Use. Delay.</strong> Make sure there is time in between messages to the Adafruit IO MQTT broker. If you&#39;re saving data in an Arduino or CircuitPython sketch inside the program&#39;s main loop, make sure you&#39;re delaying, sleeping, or using some other technique to put space in between messages.</p>

<p><strong>Use current libraries.</strong> Adafruit provides complete API client libraries for Arduino, Python, Ruby, and Javascript. When in doubt, use our code to build your next project.</p>

<p><strong>Use the least data possible.</strong> It is always better to send data from a sensor infrequently and slowly increase the frequency as needed rather than sending as quickly as possible from the beginning. An old device or project that you forgot about can easily take down your whole account when you go to add something new. Also, when dealing with sensors like temperature, outdoor light level, or wind speed, reality doesn&#39;t change very fast so there&#39;s no need for your data to change fast either.</p>

<p><strong>Never reuse Internet of Things projects from other systems without making sure it conforms to Adafruit IO&#39;s requirements</strong>. Code that works with Home Assistant, Node Red, or any other open source MQTT broker is likely to use MQTT topic conventions that <em>will not work</em> with Adafruit IO. Plugging Adafruit IO&#39;s broker credentials into an example project from another system is a quick way to get your account locked by a runaway process.</p>

<p><strong>Ask questions on the forums or Discord!</strong> There&#39;s a community of people who may have already run into the same problem you&#39;re having. Search the forums, ask a question, stop by and see what people are working on. Whatever approach you take, you being involved in the Adafruit community can make the difference for someone else. You can find the forums here: <a href="https://forums.adafruit.com/viewforum.php?f=56">https://forums.adafruit.com/viewforum.php?f=56</a> and sign up for Adafruit&#39;s Discord chat server here: <a href="https://discord.gg/adafruit">https://discord.gg/adafruit</a></p>

      </div>

      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">cURL</a>
                <a href="#" data-language-name="cpp">Arduino</a>
                <a href="#" data-language-name="python">Python</a>
                <a href="#" data-language-name="python">Circuitpython</a>
                <a href="#" data-language-name="ruby">Ruby</a>
          </div>
      </div>
    </div>
  </body>
</html>
